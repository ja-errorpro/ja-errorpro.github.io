<!doctype html><html lang=zh-Hant-TW><head><link rel=preload href=/%20lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/%20lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/%20lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/%20lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script><link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>【AIS3】Cloud Security | ErrorPro</title><link rel=canonical href=https://ja-errorpro.codes/posts/2024/ais3_d4_2/><meta name=description content="我覺得現在在看這句話的人超電"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:url" content="https://ja-errorpro.codes/posts/2024/ais3_d4_2/"><meta property="og:site_name" content="ErrorPro"><meta property="og:title" content="【AIS3】Cloud Security"><meta property="og:description" content="Cloud Security -中華資安國際 資安研究員 黃聖筌 Husky
雲端基本介紹 為啥上雲 實現靈活的資應用 幫助企業降低成本支出 按一按就可以升級 資安沒做好還是會噴$$
降低行業入門門檻 節省實體硬體成本 專注於業務發展 不須管理硬體與伺服器維運 故障機率低 除了前幾天的 Azure 安全? 不安全 雲端介紹 責任 出問題時可以踢皮球
責任歸屬 使用者永遠保有下面責任 資料 CSA Top11 Insufficient identity, credentials, access, and key Management Insecure interfaces and application programming interfaces (APIs) Misconfiguration and inadequate change control Lack of cloud security architecture and strategy Insecure software development Unsecured third-party resources System vulnerabilities Accidental cloud data disclosure Misconfiguration and exploitation of serverless and container workloads Organized crime/hackers/advanced persistent threats (APTs) Cloud storage data exfiltration https://blog.barracuda.com/2022/06/20/csa-identifies-top-11-cloud-security-impediments"><meta property="og:locale" content="zh_Hant_TW"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-08-01T00:00:00+08:00"><meta property="article:modified_time" content="2024-08-01T00:00:00+08:00"><meta property="article:tag" content="Ctf"><meta name=twitter:card content="summary"><meta name=twitter:title content="【AIS3】Cloud Security"><meta name=twitter:description content="Cloud Security -中華資安國際 資安研究員 黃聖筌 Husky
雲端基本介紹 為啥上雲 實現靈活的資應用 幫助企業降低成本支出 按一按就可以升級 資安沒做好還是會噴$$
降低行業入門門檻 節省實體硬體成本 專注於業務發展 不須管理硬體與伺服器維運 故障機率低 除了前幾天的 Azure 安全? 不安全 雲端介紹 責任 出問題時可以踢皮球
責任歸屬 使用者永遠保有下面責任 資料 CSA Top11 Insufficient identity, credentials, access, and key Management Insecure interfaces and application programming interfaces (APIs) Misconfiguration and inadequate change control Lack of cloud security architecture and strategy Insecure software development Unsecured third-party resources System vulnerabilities Accidental cloud data disclosure Misconfiguration and exploitation of serverless and container workloads Organized crime/hackers/advanced persistent threats (APTs) Cloud storage data exfiltration https://blog.barracuda.com/2022/06/20/csa-identifies-top-11-cloud-security-impediments"><link rel=stylesheet href=https://ja-errorpro.codes/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N+XoIuZg=="><link rel=stylesheet href=https://ja-errorpro.codes/css/highlight.css><link rel=stylesheet href=https://ja-errorpro.codes/css/style-dark.css><link rel=stylesheet href=https://ja-errorpro.codes/css/search.css><link rel=stylesheet href=https://ja-errorpro.codes/css/cursor.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://ja-errorpro.codes/images/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-LP899FV1TS"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LP899FV1TS")</script></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>主頁</a></li><li><a href=/posts>廢文區</a></li><li><a href=/resources>資源</a></li><li><a href=/tags>標籤</a></li><li><a href=/comment>留言區</a></li><li><a href=/about>關於本人</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://ja-errorpro.codes/posts/2024/ais3_d4_3/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class=icon href=https://ja-errorpro.codes/posts/2024/ais3_d4_1/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fja-errorpro.codes%2fposts%2f2024%2fais3_d4_2%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fja-errorpro.codes%2fposts%2f2024%2fais3_d4_2%2f&text=%e3%80%90AIS3%e3%80%91Cloud%20Security" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fja-errorpro.codes%2fposts%2f2024%2fais3_d4_2%2f&title=%e3%80%90AIS3%e3%80%91Cloud%20Security" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fja-errorpro.codes%2fposts%2f2024%2fais3_d4_2%2f&is_video=false&description=%e3%80%90AIS3%e3%80%91Cloud%20Security" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=%e3%80%90AIS3%e3%80%91Cloud%20Security&body=Check out this article: https%3a%2f%2fja-errorpro.codes%2fposts%2f2024%2fais3_d4_2%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fja-errorpro.codes%2fposts%2f2024%2fais3_d4_2%2f&title=%e3%80%90AIS3%e3%80%91Cloud%20Security" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fja-errorpro.codes%2fposts%2f2024%2fais3_d4_2%2f&title=%e3%80%90AIS3%e3%80%91Cloud%20Security" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fja-errorpro.codes%2fposts%2f2024%2fais3_d4_2%2f&name=%e3%80%90AIS3%e3%80%91Cloud%20Security&description=%3ch1%20id%3d%22cloud-security%22%3eCloud%20Security%3c%2fh1%3e%0a%3cp%3e%3ccode%3e-%e4%b8%ad%e8%8f%af%e8%b3%87%e5%ae%89%e5%9c%8b%e9%9a%9b%20%e8%b3%87%e5%ae%89%e7%a0%94%e7%a9%b6%e5%93%a1%20%e9%bb%83%e8%81%96%e7%ad%8c%20Husky%3c%2fcode%3e%3c%2fp%3e%0a%3ch2%20id%3d%22%e9%9b%b2%e7%ab%af%e5%9f%ba%e6%9c%ac%e4%bb%8b%e7%b4%b9%22%3e%e9%9b%b2%e7%ab%af%e5%9f%ba%e6%9c%ac%e4%bb%8b%e7%b4%b9%3c%2fh2%3e%0a%3ch3%20id%3d%22%e7%82%ba%e5%95%a5%e4%b8%8a%e9%9b%b2%22%3e%e7%82%ba%e5%95%a5%e4%b8%8a%e9%9b%b2%3c%2fh3%3e%0a%3cul%3e%0a%3cli%3e%e5%af%a6%e7%8f%be%e9%9d%88%e6%b4%bb%e7%9a%84%e8%b3%87%e6%87%89%e7%94%a8%0a%3cul%3e%0a%3cli%3e%e5%b9%ab%e5%8a%a9%e4%bc%81%e6%a5%ad%e9%99%8d%e4%bd%8e%e6%88%90%e6%9c%ac%e6%94%af%e5%87%ba%3c%2fli%3e%0a%3cli%3e%e6%8c%89%e4%b8%80%e6%8c%89%e5%b0%b1%e5%8f%af%e4%bb%a5%e5%8d%87%e7%b4%9a%0a%3cblockquote%3e%0a%3cp%3e%e8%b3%87%e5%ae%89%e6%b2%92%e5%81%9a%e5%a5%bd%e9%82%84%e6%98%af%e6%9c%83%e5%99%b4%24%24%3c%2fp%3e%0a%3c%2fblockquote%3e%0a%3c%2fli%3e%0a%3c%2ful%3e%0a%3c%2fli%3e%0a%3cli%3e%e9%99%8d%e4%bd%8e%e8%a1%8c%e6%a5%ad%e5%85%a5%e9%96%80%e9%96%80%e6%aa%bb%0a%3cul%3e%0a%3cli%3e%e7%af%80%e7%9c%81%e5%af%a6%e9%ab%94%e7%a1%ac%e9%ab%94%e6%88%90%e6%9c%ac%3c%2fli%3e%0a%3c%2ful%3e%0a%3c%2fli%3e%0a%3cli%3e%e5%b0%88%e6%b3%a8%e6%96%bc%e6%a5%ad%e5%8b%99%e7%99%bc%e5%b1%95%0a%3cul%3e%0a%3cli%3e%e4%b8%8d%e9%a0%88%e7%ae%a1%e7%90%86%e7%a1%ac%e9%ab%94%e8%88%87%e4%bc%ba%e6%9c%8d%e5%99%a8%e7%b6%ad%e9%81%8b%3c%2fli%3e%0a%3cli%3e%e6%95%85%e9%9a%9c%e6%a9%9f%e7%8e%87%e4%bd%8e%20%3cdel%3e%e9%99%a4%e4%ba%86%e5%89%8d%e5%b9%be%e5%a4%a9%e7%9a%84%20Azure%3c%2fdel%3e%3c%2fli%3e%0a%3c%2ful%3e%0a%3c%2fli%3e%0a%3cli%3e%e5%ae%89%e5%85%a8%3f%0a%3cul%3e%0a%3cli%3e%e4%b8%8d%e5%ae%89%e5%85%a8%3c%2fli%3e%0a%3c%2ful%3e%0a%3c%2fli%3e%0a%3c%2ful%3e%0a%3ch3%20id%3d%22%e9%9b%b2%e7%ab%af%e4%bb%8b%e7%b4%b9%22%3e%e9%9b%b2%e7%ab%af%e4%bb%8b%e7%b4%b9%3c%2fh3%3e%0a%3ch4%20id%3d%22%e8%b2%ac%e4%bb%bb%22%3e%e8%b2%ac%e4%bb%bb%3c%2fh4%3e%0a%3cp%3e%e5%87%ba%e5%95%8f%e9%a1%8c%e6%99%82%e5%8f%af%e4%bb%a5%e8%b8%a2%e7%9a%ae%e7%90%83%3c%2fp%3e%0a%3ch4%20id%3d%22%e8%b2%ac%e4%bb%bb%e6%ad%b8%e5%b1%ac%22%3e%e8%b2%ac%e4%bb%bb%e6%ad%b8%e5%b1%ac%3c%2fh4%3e%0a%3cul%3e%0a%3cli%3e%e4%bd%bf%e7%94%a8%e8%80%85%e6%b0%b8%e9%81%a0%e4%bf%9d%e6%9c%89%e4%b8%8b%e9%9d%a2%e8%b2%ac%e4%bb%bb%0a%3cul%3e%0a%3cli%3e%e8%b3%87%e6%96%99%3c%2fli%3e%0a%3c%2ful%3e%0a%3c%2fli%3e%0a%3c%2ful%3e%0a%3ch4%20id%3d%22csa-top11httpsblogbarracudacom20220620csa-identifies-top-11-cloud-security-impediments%22%3e%3ca%20href%3d%22https%3a%2f%2fblog.barracuda.com%2f2022%2f06%2f20%2fcsa-identifies-top-11-cloud-security-impediments%22%3eCSA%20Top11%3c%2fa%3e%3c%2fh4%3e%0a%3col%3e%0a%3cli%3eInsufficient%20identity%2c%20credentials%2c%20access%2c%20and%20key%20Management%3c%2fli%3e%0a%3cli%3eInsecure%20interfaces%20and%20application%20programming%20interfaces%20%28APIs%29%3c%2fli%3e%0a%3cli%3eMisconfiguration%20and%20inadequate%20change%20control%3c%2fli%3e%0a%3cli%3eLack%20of%20cloud%20security%20architecture%20and%20strategy%3c%2fli%3e%0a%3cli%3eInsecure%20software%20development%3c%2fli%3e%0a%3cli%3eUnsecured%20third-party%20resources%3c%2fli%3e%0a%3cli%3eSystem%20vulnerabilities%3c%2fli%3e%0a%3cli%3eAccidental%20cloud%20data%20disclosure%3c%2fli%3e%0a%3cli%3eMisconfiguration%20and%20exploitation%20of%20serverless%20and%20container%20workloads%3c%2fli%3e%0a%3cli%3eOrganized%20crime%2fhackers%2fadvanced%20persistent%20threats%20%28APTs%29%3c%2fli%3e%0a%3cli%3eCloud%20storage%20data%20exfiltration%3c%2fli%3e%0a%3c%2fol%3e%0a%3cp%3e%3ca%20href%3d%22https%3a%2f%2fblog.barracuda.com%2f2022%2f06%2f20%2fcsa-identifies-top-11-cloud-security-impediments%22%3ehttps%3a%2f%2fblog.barracuda.com%2f2022%2f06%2f20%2fcsa-identifies-top-11-cloud-security-impediments%3c%2fa%3e%3c%2fp%3e" aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fja-errorpro.codes%2fposts%2f2024%2fais3_d4_2%2f&t=%e3%80%90AIS3%e3%80%91Cloud%20Security" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents><ul><li><a href=#雲端基本介紹>雲端基本介紹</a><ul><li><a href=#為啥上雲>為啥上雲</a></li><li><a href=#雲端介紹>雲端介紹</a><ul><li><a href=#責任>責任</a></li><li><a href=#責任歸屬>責任歸屬</a></li><li><a href=#csa-top11httpsblogbarracudacom20220620csa-identifies-top-11-cloud-security-impediments><a href=https://blog.barracuda.com/2022/06/20/csa-identifies-top-11-cloud-security-impediments>CSA Top11</a></a></li><li><a href=#mitre-attck-cloud>MITRE ATT&amp;CK Cloud</a></li><li><a href=#s3>S3</a></li><li><a href=#iam>IAM</a></li><li><a href=#sns>SNS</a></li><li><a href=#function>function</a></li><li><a href=#cdn>CDN</a></li><li><a href=#auto-scaling>Auto Scaling</a></li><li><a href=#marketplace>marketplace</a></li><li><a href=#cognito>cognito</a></li><li><a href=#metadata-service>metadata service</a></li></ul></li></ul></li><li><a href=#探索雲端進入點>探索雲端進入點</a><ul><li><a href=#資訊蒐集>資訊蒐集</a><ul><li><a href=#ip-列舉>ip 列舉</a></li><li><a href=#回應特徵>回應特徵</a></li></ul></li><li><a href=#繞-cdn>繞 CDN</a><ul><li><a href=#為甚麼要繞過-cdn>為甚麼要繞過 CDN</a></li></ul></li><li><a href=#撿-token>撿 token</a></li></ul></li><li><a href=#常見雲端弱點>常見雲端弱點</a><ul><li><a href=#s3-1>S3</a></li><li><a href=#metadata-利用>Metadata 利用</a><ul><li><a href=#sts-臨時憑證>STS 臨時憑證</a></li><li><a href=#取得-metadata>取得 metadata</a></li><li><a href=#ssrf>SSRF</a></li></ul></li><li><a href=#設定-aws-cli>設定 AWS CLI</a></li><li><a href=#lambda>lambda</a></li><li><a href=#找東西>找東西</a><ul><li><a href=#調查-lambda>調查 lambda</a></li><li><a href=#調查程式碼>調查程式碼</a></li></ul></li><li><a href=#pacu>PACU</a></li></ul></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">【AIS3】Cloud Security</h1><div class=meta><div class=postdate><time datetime="2024-08-01 00:00:00 +0800 CST" itemprop=datePublished>2024-08-01</time></div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/ctf rel=tag>CTF</a></div></div></header><div class=content itemprop=articleBody><h1 id=cloud-security>Cloud Security</h1><p><code>-中華資安國際 資安研究員 黃聖筌 Husky</code></p><h2 id=雲端基本介紹>雲端基本介紹</h2><h3 id=為啥上雲>為啥上雲</h3><ul><li>實現靈活的資應用<ul><li>幫助企業降低成本支出</li><li>按一按就可以升級<blockquote><p>資安沒做好還是會噴$$</p></blockquote></li></ul></li><li>降低行業入門門檻<ul><li>節省實體硬體成本</li></ul></li><li>專注於業務發展<ul><li>不須管理硬體與伺服器維運</li><li>故障機率低 <del>除了前幾天的 Azure</del></li></ul></li><li>安全?<ul><li>不安全</li></ul></li></ul><h3 id=雲端介紹>雲端介紹</h3><h4 id=責任>責任</h4><p>出問題時可以踢皮球</p><h4 id=責任歸屬>責任歸屬</h4><ul><li>使用者永遠保有下面責任<ul><li>資料</li></ul></li></ul><h4 id=csa-top11httpsblogbarracudacom20220620csa-identifies-top-11-cloud-security-impediments><a href=https://blog.barracuda.com/2022/06/20/csa-identifies-top-11-cloud-security-impediments>CSA Top11</a></h4><ol><li>Insufficient identity, credentials, access, and key Management</li><li>Insecure interfaces and application programming interfaces (APIs)</li><li>Misconfiguration and inadequate change control</li><li>Lack of cloud security architecture and strategy</li><li>Insecure software development</li><li>Unsecured third-party resources</li><li>System vulnerabilities</li><li>Accidental cloud data disclosure</li><li>Misconfiguration and exploitation of serverless and container workloads</li><li>Organized crime/hackers/advanced persistent threats (APTs)</li><li>Cloud storage data exfiltration</li></ol><p><a href=https://blog.barracuda.com/2022/06/20/csa-identifies-top-11-cloud-security-impediments>https://blog.barracuda.com/2022/06/20/csa-identifies-top-11-cloud-security-impediments</a></p><h4 id=mitre-attck-cloud>MITRE ATT&amp;CK Cloud</h4><p>雲端還進儲存的log有限
要分析的log來自多處</p><ul><li>CloudTrail</li><li>Amazon GuardDuty<ul><li>情資、威脅資料庫</li></ul></li></ul><h4 id=s3>S3</h4><ul><li>用來存東西<blockquote><p>當作雲端硬碟</p></blockquote></li></ul><h4 id=iam>IAM</h4><p>IAM 是 AWS 的身分與訪問管理服務</p><p>IAM policy &ndash;assign&ndash;> IAM rule &ndash;assign&ndash;> EC2
同角色可有多個 policy</p><p>JSON</p><ul><li>sid descript</li></ul><pre tabindex=0><code>
sid
effect
action
resource
MFA
</code></pre><p>accesskeyid
secretaccesskey</p><h4 id=sns>SNS</h4><h4 id=function>function</h4><p>FAAS (function as a servcie)
lambda</p><h4 id=cdn>CDN</h4><p>cache
珍珠奶茶開分店，配方來自主站</p><p>cloudflare</p><h4 id=auto-scaling>Auto Scaling</h4><p>load balance
發現過載過開時會幫你開主機，過低時幫你關主機
有資安事件時不好追蹤</p><h4 id=marketplace>marketplace</h4><p>也許會撿到別人的主機</p><h4 id=cognito>cognito</h4><p>提供雲端 interface
做 web 驗證</p><h4 id=metadata-service>metadata service</h4><ul><li>初始化 EC2 的東東</li><li>security credential
AWSHCP/Azure/digital ocean/helion/openStack: 169.254.169.254
oracle: 192.0.0.192
alibaba: 100.100.100.200</li></ul><h2 id=探索雲端進入點>探索雲端進入點</h2><h3 id=資訊蒐集>資訊蒐集</h3><h4 id=ip-列舉>ip 列舉</h4><h4 id=回應特徵>回應特徵</h4><p>header
路徑
請求對象</p><h3 id=繞-cdn>繞 CDN</h3><h4 id=為甚麼要繞過-cdn>為甚麼要繞過 CDN</h4><ul><li>CDN 有 WAF</li><li>cloudflare: 使用 CF-Connecting-IP header</li></ul><h3 id=撿-token>撿 token</h3><ul><li>github</li><li>.git</li><li>debug msg</li><li>TruffleHog<ul><li><code>trufflehog git &lt;git></code></li></ul></li><li>gitguardian</li><li>honeytoken<ul><li>非服務的 honeypot</li><li><a href=https://canarytokens.org/generate>https://canarytokens.org/generate</a></li></ul></li></ul><h2 id=常見雲端弱點>常見雲端弱點</h2><h3 id=s3-1>S3</h3><ul><li>Simple Storge Service</li><li>裡面放什麼<ul><li>靜態網站、網頁、檔案</li><li>資料庫存檔、備份、使用者data</li><li>log</li></ul></li><li>常見問題<ul><li>權限設定錯誤<blockquote><p>設置複雜，容易撿到原始碼</p></blockquote></li><li>意外存取</li></ul></li><li>權限錯誤<ul><li>誤以為給別人存取就要設為公開</li><li>過於寬鬆的限制 <code>s3:*</code><blockquote><p>設定上要注意最小化原則</p></blockquote></li></ul></li></ul><p><a href=https://buckets.grayhatwarfare.com/>https://buckets.grayhatwarfare.com/</a></p><ul><li>如何列舉目標的 S3<ul><li>使用字典檔</li></ul></li><li>如何生成字典檔<ul><li>手動產生<ul><li>公司名稱</li><li>參考實際名稱</li><li></li></ul></li><li>自動產生</li></ul></li><li>Bucket Name有唯一性</li><li>網址格式<ul><li>[bucket:name].s3.地區.amazonaws.com<blockquote><p>通常地區可以省略，但有些不行</p></blockquote></li><li>地區.s3.amazonaws.com/[bucket name]</li></ul></li><li>範例網址<ul><li>ais3-public-bucket.s3.us.east</li></ul></li><li>地區列表(aws官方有)</li><li>自訂網域<ul><li>使用 img.ais3.org 而不是 ais3.s3.amazonaws.com</li></ul></li><li>對應方法<ul><li>img.ais3.org 地區</li></ul></li></ul><h3 id=metadata-利用>Metadata 利用</h3><h4 id=sts-臨時憑證>STS 臨時憑證</h4><p>~/.aws/credential</p><p>列舉 policy</p><h4 id=取得-metadata>取得 metadata</h4><ul><li>Get Shell直接拿</li><li>command injection-</li><li>SSRF</li></ul><h4 id=ssrf>SSRF</h4><ul><li>IMDSv1<ul><li>request/response<ul><li>http://169.254.169.254/latest/meta-data/iam/security-credentials/</li></ul></li></ul></li></ul><pre tabindex=0><code>aws configure set aws_access_key_id ASIAXTN2BMI6HUQSRU46
aws configure set aws_secret_access_key VcsxxgwAqihJyhLdIN2tFhCXQqzw0Io7Ft8yhv9j
aws configure set aws_session_token &#34;...&lt;SNIP&gt;...&#34;

aws s3 ls 
aws s3 ls s3://ais3-husky/
aws s3 cp s3://ais3-husky/SSRF_1.txt ./
cat SSRF_1.txt # FLAG{IMDSv1_is_insecure!}
</code></pre><ul><li>IMDSv2<ul><li>構造 put</li><li>加 header</li><li>gopher<ul><li><code>curl -X PUT http://127.0.0.1/latest/api/token --header "X-aws-ec2-metadata-token-ttl-seconds: 21600"</code></li></ul></li></ul></li></ul><h3 id=設定-aws-cli>設定 AWS CLI</h3><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt update
</span></span><span style=display:flex><span>sudo apt install awscli –y 
</span></span><span style=display:flex><span>aws configure --profile level1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 輸入 key_id</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 輸入 access_key</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 留空 None</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># 留空 json</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>vim ~/.aws/credentials
</span></span><span style=display:flex><span><span style=color:#6272a4># 新增 aws_session_token</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>aws s3 ls --profile level1
</span></span><span style=display:flex><span>aws s3 ls ais3-husky --profile level1
</span></span><span style=display:flex><span>aws s3 cp s3://ais3-husky/SSRF_1.txt . --profile level1
</span></span></code></pre></td></tr></table></div></div><h3 id=lambda>lambda</h3><ul><li><p>限制</p><ul><li>記憶體 512MB</li><li>執行時間 15min</li><li>檔案存取</li><li>檔案數量</li><li>程式語言</li></ul></li><li><p>不會立刻回收空間</p></li><li><p>檔案存取限制</p></li><li><p>無 metadata Service，但&mldr;</p><ul><li>原始碼放在 /var/task</li><li>資料暫存區 /tmp</li><li>AWS key 放在環境變數
主動觸發</li></ul></li></ul><h3 id=找東西>找東西</h3><ul><li>/var/task 原始碼</li><li>環境變數 AWS Key</li></ul><h4 id=調查-lambda>調查 lambda</h4><ul><li>列出 Lambda Functions
<code>aws lambda list-function --profile &lt;profile> --region &lt;region></code>
<code>aws lambda get-funciton</code></li></ul><h4 id=調查程式碼>調查程式碼</h4><ul><li>函數弱點<ul><li><code>os.popen('cat ' + str)</code></li></ul></li></ul><h3 id=pacu>PACU</h3><p>降權限 token 仍然有效，應刪除 IAM 角色
臨時性限制</p></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>主頁</a></li><li><a href=/posts>廢文區</a></li><li><a href=/resources>資源</a></li><li><a href=/tags>標籤</a></li><li><a href=/comment>留言區</a></li><li><a href=/about>關於本人</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><a href=#雲端基本介紹>雲端基本介紹</a><ul><li><a href=#為啥上雲>為啥上雲</a></li><li><a href=#雲端介紹>雲端介紹</a><ul><li><a href=#責任>責任</a></li><li><a href=#責任歸屬>責任歸屬</a></li><li><a href=#csa-top11httpsblogbarracudacom20220620csa-identifies-top-11-cloud-security-impediments><a href=https://blog.barracuda.com/2022/06/20/csa-identifies-top-11-cloud-security-impediments>CSA Top11</a></a></li><li><a href=#mitre-attck-cloud>MITRE ATT&amp;CK Cloud</a></li><li><a href=#s3>S3</a></li><li><a href=#iam>IAM</a></li><li><a href=#sns>SNS</a></li><li><a href=#function>function</a></li><li><a href=#cdn>CDN</a></li><li><a href=#auto-scaling>Auto Scaling</a></li><li><a href=#marketplace>marketplace</a></li><li><a href=#cognito>cognito</a></li><li><a href=#metadata-service>metadata service</a></li></ul></li></ul></li><li><a href=#探索雲端進入點>探索雲端進入點</a><ul><li><a href=#資訊蒐集>資訊蒐集</a><ul><li><a href=#ip-列舉>ip 列舉</a></li><li><a href=#回應特徵>回應特徵</a></li></ul></li><li><a href=#繞-cdn>繞 CDN</a><ul><li><a href=#為甚麼要繞過-cdn>為甚麼要繞過 CDN</a></li></ul></li><li><a href=#撿-token>撿 token</a></li></ul></li><li><a href=#常見雲端弱點>常見雲端弱點</a><ul><li><a href=#s3-1>S3</a></li><li><a href=#metadata-利用>Metadata 利用</a><ul><li><a href=#sts-臨時憑證>STS 臨時憑證</a></li><li><a href=#取得-metadata>取得 metadata</a></li><li><a href=#ssrf>SSRF</a></li></ul></li><li><a href=#設定-aws-cli>設定 AWS CLI</a></li><li><a href=#lambda>lambda</a></li><li><a href=#找東西>找東西</a><ul><li><a href=#調查-lambda>調查 lambda</a></li><li><a href=#調查程式碼>調查程式碼</a></li></ul></li><li><a href=#pacu>PACU</a></li></ul></li></ul></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fja-errorpro.codes%2fposts%2f2024%2fais3_d4_2%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fja-errorpro.codes%2fposts%2f2024%2fais3_d4_2%2f&text=%e3%80%90AIS3%e3%80%91Cloud%20Security" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fja-errorpro.codes%2fposts%2f2024%2fais3_d4_2%2f&title=%e3%80%90AIS3%e3%80%91Cloud%20Security" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fja-errorpro.codes%2fposts%2f2024%2fais3_d4_2%2f&is_video=false&description=%e3%80%90AIS3%e3%80%91Cloud%20Security" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=%e3%80%90AIS3%e3%80%91Cloud%20Security&body=Check out this article: https%3a%2f%2fja-errorpro.codes%2fposts%2f2024%2fais3_d4_2%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fja-errorpro.codes%2fposts%2f2024%2fais3_d4_2%2f&title=%e3%80%90AIS3%e3%80%91Cloud%20Security" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fja-errorpro.codes%2fposts%2f2024%2fais3_d4_2%2f&title=%e3%80%90AIS3%e3%80%91Cloud%20Security" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fja-errorpro.codes%2fposts%2f2024%2fais3_d4_2%2f&name=%e3%80%90AIS3%e3%80%91Cloud%20Security&description=%3ch1%20id%3d%22cloud-security%22%3eCloud%20Security%3c%2fh1%3e%0a%3cp%3e%3ccode%3e-%e4%b8%ad%e8%8f%af%e8%b3%87%e5%ae%89%e5%9c%8b%e9%9a%9b%20%e8%b3%87%e5%ae%89%e7%a0%94%e7%a9%b6%e5%93%a1%20%e9%bb%83%e8%81%96%e7%ad%8c%20Husky%3c%2fcode%3e%3c%2fp%3e%0a%3ch2%20id%3d%22%e9%9b%b2%e7%ab%af%e5%9f%ba%e6%9c%ac%e4%bb%8b%e7%b4%b9%22%3e%e9%9b%b2%e7%ab%af%e5%9f%ba%e6%9c%ac%e4%bb%8b%e7%b4%b9%3c%2fh2%3e%0a%3ch3%20id%3d%22%e7%82%ba%e5%95%a5%e4%b8%8a%e9%9b%b2%22%3e%e7%82%ba%e5%95%a5%e4%b8%8a%e9%9b%b2%3c%2fh3%3e%0a%3cul%3e%0a%3cli%3e%e5%af%a6%e7%8f%be%e9%9d%88%e6%b4%bb%e7%9a%84%e8%b3%87%e6%87%89%e7%94%a8%0a%3cul%3e%0a%3cli%3e%e5%b9%ab%e5%8a%a9%e4%bc%81%e6%a5%ad%e9%99%8d%e4%bd%8e%e6%88%90%e6%9c%ac%e6%94%af%e5%87%ba%3c%2fli%3e%0a%3cli%3e%e6%8c%89%e4%b8%80%e6%8c%89%e5%b0%b1%e5%8f%af%e4%bb%a5%e5%8d%87%e7%b4%9a%0a%3cblockquote%3e%0a%3cp%3e%e8%b3%87%e5%ae%89%e6%b2%92%e5%81%9a%e5%a5%bd%e9%82%84%e6%98%af%e6%9c%83%e5%99%b4%24%24%3c%2fp%3e%0a%3c%2fblockquote%3e%0a%3c%2fli%3e%0a%3c%2ful%3e%0a%3c%2fli%3e%0a%3cli%3e%e9%99%8d%e4%bd%8e%e8%a1%8c%e6%a5%ad%e5%85%a5%e9%96%80%e9%96%80%e6%aa%bb%0a%3cul%3e%0a%3cli%3e%e7%af%80%e7%9c%81%e5%af%a6%e9%ab%94%e7%a1%ac%e9%ab%94%e6%88%90%e6%9c%ac%3c%2fli%3e%0a%3c%2ful%3e%0a%3c%2fli%3e%0a%3cli%3e%e5%b0%88%e6%b3%a8%e6%96%bc%e6%a5%ad%e5%8b%99%e7%99%bc%e5%b1%95%0a%3cul%3e%0a%3cli%3e%e4%b8%8d%e9%a0%88%e7%ae%a1%e7%90%86%e7%a1%ac%e9%ab%94%e8%88%87%e4%bc%ba%e6%9c%8d%e5%99%a8%e7%b6%ad%e9%81%8b%3c%2fli%3e%0a%3cli%3e%e6%95%85%e9%9a%9c%e6%a9%9f%e7%8e%87%e4%bd%8e%20%3cdel%3e%e9%99%a4%e4%ba%86%e5%89%8d%e5%b9%be%e5%a4%a9%e7%9a%84%20Azure%3c%2fdel%3e%3c%2fli%3e%0a%3c%2ful%3e%0a%3c%2fli%3e%0a%3cli%3e%e5%ae%89%e5%85%a8%3f%0a%3cul%3e%0a%3cli%3e%e4%b8%8d%e5%ae%89%e5%85%a8%3c%2fli%3e%0a%3c%2ful%3e%0a%3c%2fli%3e%0a%3c%2ful%3e%0a%3ch3%20id%3d%22%e9%9b%b2%e7%ab%af%e4%bb%8b%e7%b4%b9%22%3e%e9%9b%b2%e7%ab%af%e4%bb%8b%e7%b4%b9%3c%2fh3%3e%0a%3ch4%20id%3d%22%e8%b2%ac%e4%bb%bb%22%3e%e8%b2%ac%e4%bb%bb%3c%2fh4%3e%0a%3cp%3e%e5%87%ba%e5%95%8f%e9%a1%8c%e6%99%82%e5%8f%af%e4%bb%a5%e8%b8%a2%e7%9a%ae%e7%90%83%3c%2fp%3e%0a%3ch4%20id%3d%22%e8%b2%ac%e4%bb%bb%e6%ad%b8%e5%b1%ac%22%3e%e8%b2%ac%e4%bb%bb%e6%ad%b8%e5%b1%ac%3c%2fh4%3e%0a%3cul%3e%0a%3cli%3e%e4%bd%bf%e7%94%a8%e8%80%85%e6%b0%b8%e9%81%a0%e4%bf%9d%e6%9c%89%e4%b8%8b%e9%9d%a2%e8%b2%ac%e4%bb%bb%0a%3cul%3e%0a%3cli%3e%e8%b3%87%e6%96%99%3c%2fli%3e%0a%3c%2ful%3e%0a%3c%2fli%3e%0a%3c%2ful%3e%0a%3ch4%20id%3d%22csa-top11httpsblogbarracudacom20220620csa-identifies-top-11-cloud-security-impediments%22%3e%3ca%20href%3d%22https%3a%2f%2fblog.barracuda.com%2f2022%2f06%2f20%2fcsa-identifies-top-11-cloud-security-impediments%22%3eCSA%20Top11%3c%2fa%3e%3c%2fh4%3e%0a%3col%3e%0a%3cli%3eInsufficient%20identity%2c%20credentials%2c%20access%2c%20and%20key%20Management%3c%2fli%3e%0a%3cli%3eInsecure%20interfaces%20and%20application%20programming%20interfaces%20%28APIs%29%3c%2fli%3e%0a%3cli%3eMisconfiguration%20and%20inadequate%20change%20control%3c%2fli%3e%0a%3cli%3eLack%20of%20cloud%20security%20architecture%20and%20strategy%3c%2fli%3e%0a%3cli%3eInsecure%20software%20development%3c%2fli%3e%0a%3cli%3eUnsecured%20third-party%20resources%3c%2fli%3e%0a%3cli%3eSystem%20vulnerabilities%3c%2fli%3e%0a%3cli%3eAccidental%20cloud%20data%20disclosure%3c%2fli%3e%0a%3cli%3eMisconfiguration%20and%20exploitation%20of%20serverless%20and%20container%20workloads%3c%2fli%3e%0a%3cli%3eOrganized%20crime%2fhackers%2fadvanced%20persistent%20threats%20%28APTs%29%3c%2fli%3e%0a%3cli%3eCloud%20storage%20data%20exfiltration%3c%2fli%3e%0a%3c%2fol%3e%0a%3cp%3e%3ca%20href%3d%22https%3a%2f%2fblog.barracuda.com%2f2022%2f06%2f20%2fcsa-identifies-top-11-cloud-security-impediments%22%3ehttps%3a%2f%2fblog.barracuda.com%2f2022%2f06%2f20%2fcsa-identifies-top-11-cloud-security-impediments%3c%2fa%3e%3c%2fp%3e" aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fja-errorpro.codes%2fposts%2f2024%2fais3_d4_2%2f&t=%e3%80%90AIS3%e3%80%91Cloud%20Security" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick='return $("#toc-footer").toggle(),!1' aria-label=TOC><i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2024 ErrorPro</div><div class=footer-right><nav><ul><li><a href=/>主頁</a></li><li><a href=/posts>廢文區</a></li><li><a href=/resources>資源</a></li><li><a href=/tags>標籤</a></li><li><a href=/comment>留言區</a></li><li><a href=/about>關於本人</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script><script src=/js/code-copy.js></script><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},svg:{fontCache:"global"}}</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><script type=text/javascript src=/js/nest.js count=150 color=255,255,255 opacity=1></script><img id=Cursor src=/images/cursor/silverwolf/01-Normal.gif>
<script type=text/javascript src=/js/cursor.js></script></html>