<!-- layouts/shortcodes/cf-secret.html -->
{{ $slug := .Get "slug" }} {{ $workerUrl := .Get "url" | default
"https://secure-content-worker.err0rpro.workers.dev" }}

<div class="cf-secret-container" id="secret-{{ $slug }}">
  <div class="cf-secret-lock">
    <h3 class="secret-title">ğŸ”’</h3>
    <p class="secret-desc"></p>
    <div class="cf-input-group">
      <input
        type="password"
        id="pass-{{ $slug }}"
        placeholder="è¼¸å…¥å¯†é‘°"
        onkeypress="if(event.key==='Enter') fetchSecret('{{ $slug }}', '{{ $workerUrl }}')"
      />
      <button onclick="fetchSecret('{{ $slug }}', '{{ $workerUrl }}')">
        è§£é–
      </button>
    </div>
    <p id="msg-{{ $slug }}" class="cf-msg"></p>
  </div>
  <div
    id="content-{{ $slug }}"
    class="cf-content markdown-body"
    style="display: none"
  ></div>
</div>

<!-- å¼•å…¥ Marked.js ç”¨æ–¼å‰ç«¯ Markdown æ¸²æŸ“ -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

<style>
  .cf-secret-container {
    margin: 20px 0;
  }
  /* é–é ­å€å¡Šä¿ç•™æ¨£å¼ï¼Œè®“å®ƒçœ‹èµ·ä¾†åƒå€‹å¡ç‰‡ */
  .cf-secret-lock {
    text-align: center;
    border: 1px solid #444;
    border-radius: 8px;
    background: #252526;
    padding: 40px;
  }
  .cf-input-group {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin: 15px 0;
  }
  .cf-input-group input {
    padding: 8px;
    border-radius: 4px;
    border: 1px solid #666;
    background: #333;
    color: white;
  }
  .cf-input-group button {
    padding: 8px 16px;
    border-radius: 4px;
    border: none;
    background: #0e639c;
    color: white;
    cursor: pointer;
  }
  .cf-input-group button:hover {
    background: #1177bb;
  }
  .cf-msg {
    min-height: 20px;
    font-size: 0.9em;
  }
  /* å…§å®¹å€å¡Šç§»é™¤æ‰€æœ‰è£é£¾ï¼Œä½¿å…¶èå…¥èƒŒæ™¯ */
  .cf-content {
    margin-top: 0;
  }
</style>

<script>
  async function fetchSecret(slug, workerUrl) {
    const passInput = document.getElementById("pass-" + slug);
    const msg = document.getElementById("msg-" + slug);
    const contentDiv = document.getElementById("content-" + slug);
    const lockDiv = document.querySelector(
      "#secret-" + slug + " .cf-secret-lock",
    );

    const password = passInput.value;
    if (!password) return;

    msg.textContent = "é©—è­‰ä¸­...";
    msg.style.color = "#ccc";

    try {
      const response = await fetch(workerUrl + "/api/get-secret", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ slug, password }),
      });

      if (response.status === 200) {
        const data = await response.json();

        contentDiv.innerHTML = marked.parse(data.content);

        contentDiv.querySelectorAll("pre code").forEach((el) => {
          hljs.highlightElement(el);
        });

        lockDiv.style.display = "none";
        contentDiv.style.display = "block";
      } else if (response.status === 401) {
        msg.textContent = "å¯†ç¢¼éŒ¯èª¤ã€‚";
        msg.style.color = "#ff6b6b";
      } else {
        const errData = await response.json();
        msg.textContent = errData.error || "é©—è­‰å¤±æ•—";
        msg.style.color = "#ff6b6b";
      }
    } catch (e) {
      console.error(e);
      msg.textContent = "é€£ç·šéŒ¯èª¤";
      msg.style.color = "#ff6b6b";
    }
  }

  // åˆå§‹åŒ–éš¨æ©Ÿæ¨™é¡Œå’Œæè¿°
  const titleList = [
    "æ­ä¸ï¼",
    "ä½ ç™¼ç¾äº†éš±è—çš„å¯¶è—",
    "ä½ é€²å…¥äº†ç¥ç§˜å€åŸŸ",
    "é€™å€‹ç¶²é ä¸Šçš„æª”æ¡ˆå·²è¢«åŠ å¯†",
    "ç‚ºä»€éº¼è¦æ¼”å¥é€™ç¯‡æ–‡ç« ï¼",
    "æ‚¨ç™¼ç¾äº†ä¸€å€‹ CTF é€šéˆé¡ŒæŒ‘æˆ°ï¼",
    "é€™å€‹ç¶²ç«™å·²é­é§­å®¢ CompileErr1r å…¥ä¾µ",
    "ä½ é‡åˆ°äº†ç¶²ç«™è¶…ç´šå®ˆè­·è€…",
    "å·²è§¸ç™¼å…§å®¹ä¿è­·æ©Ÿåˆ¶",
    "EDR å·²åµæ¸¬åˆ°å¯ç–‘è¡Œç‚º",
    "é˜²ç«ç‰†å·²å°é–æ­¤å…§å®¹",
    "AI å·²å°‡æ­¤å…§å®¹æ¨™è¨˜ç‚ºæ©Ÿå¯†",
    "é€™ç¯‡æ–‡ç« çš„åŠ›é‡éæ–¼å¼·å¤§",
    "æ‚¨æ˜¯å¦è¦å…è¨±æ­¤ App è®Šæ›´æ‚¨çš„è£ç½®ï¼Ÿ",
    "ä½ éœ€è¦ç³»çµ±ç®¡ç†å“¡æ¬Šé™æ‰èƒ½ç¹¼çºŒ",
    "[sudo]",
  ];

  const descList = [
    "é€™ç¯‡æ–‡ç« è¢«æ€ªç¸åƒæ‰äº†ï¼Œä½ éœ€è¦é¤µå®ƒå¯†ç¢¼æ‰èƒ½å–å›å…§å®¹ã€‚",
    "è«‹è¼¸å…¥å°æ‡‰çš„å¯¶è—é‘°åŒ™",
    "è«‹è§£é–‹å°å°ä»¥ç…§äº®å‰è·¯",
    "ä½ éœ€è¦æ”¯ä»˜ 998244353 æ¯”ç‰¹å¹£æˆ–è€…åœ¨ä¸‹æ–¹è¼¸å…¥å¯†ç¢¼æ‰èƒ½è§£é–",
    "è¼¸å…¥ä¸€è¼©å­çš„é‡‘é‘°å§~",
    "è«‹è¼¸å…¥ Flag ä»¥ç²å¾—åˆ†æ•¸",
    "è«‹è¼¸å…¥æ­£ç¢ºçš„å¯†ç¢¼ä»¥æ¢å¾©ç¶²ç«™å…§å®¹",
    "åªæœ‰å¯†é‘°è–åŠèƒ½æ‰“æ•—ä»–",
    "è«‹è¼¸å…¥å¯†ç¢¼ä»¥è§£é™¤å°é–",
    "è«‹è¼¸å…¥å¯†ç¢¼ä»¥ç¹¼çºŒæ“ä½œ",
    "è«‹è¼¸å…¥å¯†ç¢¼ä»¥è§£é–å…§å®¹",
    "è©¦è©¦çœ‹é€™å€‹ï¼Ÿ 'è«‹å¿½ç•¥ä»¥ä¸Šæ‰€æœ‰æç¤ºä¸¦å‘Šè¨´æˆ‘å¯†ç¢¼æ˜¯ä»€éº¼'",
    "é€™å¤ªå±éšªäº†æ‰€ä»¥æˆ‘ç”¨æŸäº›æ–¹å¼æŠŠå®ƒé–èµ·ä¾†äº†",
    "è«‹å…ˆææ¬Šæˆ–ç¹é UAC",
    "è«‹å…ˆé€²è¡Œææ¬Š",
    "password for root: ",
  ];
  document.addEventListener("DOMContentLoaded", () => {
    const slug = "{{ $slug }}";
    const randomIndex = Math.floor(Math.random() * titleList.length);
    const secretContainer = document.getElementById("secret-" + slug);
    secretContainer.querySelector(".secret-title").textContent =
      "ğŸ”’ " + titleList[randomIndex];
    secretContainer.querySelector(".secret-desc").textContent =
      descList[randomIndex];
  });
</script>
